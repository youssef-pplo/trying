name: Build Windows Executable

on:
  workflow_dispatch:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: Build executable
      shell: cmd
      run: |
        pyinstaller --onefile --windowed --name arabic-pdf-ocr --clean --noconfirm --hidden-import PySide6.QtCore --hidden-import PySide6.QtGui --hidden-import PySide6.QtWidgets --hidden-import pytesseract --hidden-import pdf2image --hidden-import PIL --hidden-import PIL.Image --hidden-import PIL.ImageEnhance --hidden-import PIL.ImageFilter --exclude-module torch --exclude-module numpy --exclude-module scipy --exclude-module matplotlib --exclude-module pandas --exclude-module sklearn --exclude-module tensorflow --exclude-module cv2 --exclude-module PySide6.QtWebEngine --exclude-module PySide6.QtWebEngineWidgets --exclude-module PySide6.QtWebSockets --exclude-module PySide6.QtQuick --exclude-module PySide6.QtQml --exclude-module PySide6.Qt3D --exclude-module PySide6.QtCharts --exclude-module PySide6.QtDataVisualization --exclude-module PySide6.QtLocation --exclude-module PySide6.QtMultimedia --exclude-module PySide6.QtMultimediaWidgets --exclude-module PySide6.QtNetwork --exclude-module PySide6.QtOpenGL --exclude-module PySide6.QtPositioning --exclude-module PySide6.QtPrintSupport --exclude-module PySide6.QtSensors --exclude-module PySide6.QtSerialPort --exclude-module PySide6.QtSql --exclude-module PySide6.QtSvg --exclude-module PySide6.QtTest --exclude-module PySide6.QtTextToSpeech --exclude-module PySide6.QtWebChannel --exclude-module PySide6.QtXml --exclude-module PySide6.QtXmlPatterns app.py
    
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: arabic-pdf-ocr-windows
        path: dist/arabic-pdf-ocr.exe

